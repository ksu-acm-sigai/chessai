{"version":3,"sources":["board.js"],"names":["NeighborType","Above","offset","AboveLeft","AboveRight","Below","BelowLeft","BelowRight","KnightAboveLeft","KnightAboveRight","KnightBelowLeft","KnightBelowRight","KnightLeftAbove","KnightLeftBelow","KnightRightAbove","KnightRightBelow","Left","Right","Board","squares","sq","n","file","rank","fIndex","i","length","f","r","charAt","side","list","piece","push","src","dest","getSquare","simulate","move","algebraic","capturedPiece","castle","enPassant","postSquare","prevSquare","p","undo","b","m","undone","Error","emit","type","PieceType","King","moveCount","Pawn","lastMovedPiece","Math","floor","Square","create","Piece","createRook","SideType","White","Black","createKnight","createBishop","createQueen","createKing","createPawn","fen","pieces","arg","method","B","k","K","N","P","q","Q","R","split","board","lines","line","arr","acc","cur","isNaN","Number","square","EventEmitter"],"mappings":"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","sourcesContent":["/**\n\tThe Board is the representation of the current position of the pieces on\n\tthe squares it contains.\n*/\nimport { Piece, PieceType, SideType } from './piece';\nimport { EventEmitter } from 'events';\nimport { Square } from './square';\n\n// types\nexport var NeighborType = {\n\tAbove : { offset : 8 },\n\tAboveLeft : { offset : 7 },\n\tAboveRight : { offset : 9 },\n\tBelow : { offset : -8 },\n\tBelowLeft : { offset : -9 },\n\tBelowRight : { offset : -7 },\n\tKnightAboveLeft : { offset : 15 },\n\tKnightAboveRight : { offset : 17 },\n\tKnightBelowLeft : { offset : -17 },\n\tKnightBelowRight : { offset : -15 },\n\tKnightLeftAbove : { offset : 6 },\n\tKnightLeftBelow : { offset : -10 },\n\tKnightRightAbove : { offset : 10 },\n\tKnightRightBelow : { offset : -6 },\n\tLeft : { offset : -1 },\n\tRight : { offset : 1 }\n};\n\n// ctor\nexport class Board extends EventEmitter {\n\tconstructor (squares) {\n\t\tsuper();\n\n\t\tthis.squares = squares;\n\t}\n\n\tstatic create () {\n\t\tlet\n\t\t\tb = new Board([]),\n\t\t\tf = 0,\n\t\t\ti = 0,\n\t\t\tr = 0,\n\t\t\tsq = null;\n\n\t\t/* eslint no-magic-numbers:0 */\n\t\tfor (i = 0; i < 64; i++) {\n\t\t\tf = Math.floor(i % 8);\n\t\t\tr = Math.floor(i / 8) + 1;\n\t\t\tsq = Square.create('abcdefgh'[f], r);\n\n\t\t\tb.squares.push(sq);\n\n\t\t\tif (r === 1 || r === 8) { // Named pieces\n\t\t\t\tif (f === 0 || f === 7) { // Rookage\n\t\t\t\t\tsq.piece = Piece.createRook(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 1 || f === 6) { // Knights\n\t\t\t\t\tsq.piece = Piece.createKnight(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 2 || f === 5) { // Bish's\n\t\t\t\t\tsq.piece = Piece.createBishop(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else if (f === 3) {\n\t\t\t\t\tsq.piece = Piece.createQueen(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tsq.piece = Piece.createKing(\n\t\t\t\t\t\tr === 1 ? SideType.White : SideType.Black\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else if (r === 2 || r === 7) { // Pawns\n\t\t\t\tsq.piece = Piece.createPawn(\n\t\t\t\t\tr === 2 ? SideType.White : SideType.Black\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn b;\n\t}\n\n\tstatic load (fen) {\n\t\tconst pieces = {\n\t\t\tb: { arg: SideType.Black, method: 'createBishop' },\n\t\t\tB: { arg: SideType.White, method: 'createBishop' },\n\t\t\tk: { arg: SideType.Black, method: 'createKing' },\n\t\t\tK: { arg: SideType.White, method: 'createKing' },\n\t\t\tn: { arg: SideType.Black, method: 'createKnight' },\n\t\t\tN: { arg: SideType.White, method: 'createKnight' },\n\t\t\tp: { arg: SideType.Black, method: 'createPawn' },\n\t\t\tP: { arg: SideType.White, method: 'createPawn' },\n\t\t\tq: { arg: SideType.Black, method: 'createQueen' },\n\t\t\tQ: { arg: SideType.White, method: 'createQueen' },\n\t\t\tr: { arg: SideType.Black, method: 'createRook' },\n\t\t\tR: { arg: SideType.White, method: 'createRook' }\n\t\t};\n\n\t\tconst [board/* , turn, castling, enPassant, halfs, moves */] = fen.split(' ');\n\t\tconst lines = board.split('/')\n\t\t\t.map((line, rank) => {\n\t\t\t\tconst arr = line.split('');\n\t\t\t\tlet file = 0;\n\n\t\t\t\treturn arr.reduce((acc, cur) => {\n\t\t\t\t\tif (!isNaN(Number(cur))) {\n\t\t\t\t\t\tfor (let i = 0; i < Number(cur); i += 1) {\n\t\t\t\t\t\t\tacc.push(Square.create('abcdefgh'[file], 8 - rank));\n\t\t\t\t\t\t\tfile = file < 7 ? file + 1 : 0;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst square = Square.create('abcdefgh'[file], 8 - rank);\n\t\t\t\t\t\tsquare.piece = Piece[pieces[cur].method](pieces[cur].arg);\n\t\t\t\t\t\tacc.push(square);\n\t\t\t\t\t\tfile = file < 7 ? file + 1 : 0;\n\t\t\t\t\t}\n\t\t\t\t\treturn acc;\n\t\t\t\t}, []);\n\t\t\t});\n\n\t\treturn new Board(lines.reduce((acc, cur) => {\n\t\t\tacc.push(...cur);\n\t\t\treturn acc;\n\t\t}, []));\n\t}\n\n\tgetNeighborSquare (sq, n) {\n\t\tif (sq && n) {\n\t\t\t// validate boundaries of board\n\t\t\tif (sq.file === 'a' && (n === NeighborType.AboveLeft ||\n\t\t\t\t\tn === NeighborType.BelowLeft ||\n\t\t\t\t\tn === NeighborType.Left)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.file === 'h' && (n === NeighborType.AboveRight ||\n\t\t\t\t\tn === NeighborType.BelowRight ||\n\t\t\t\t\tn === NeighborType.Right)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.rank === 1 && (n === NeighborType.Below ||\n\t\t\t\t\tn === NeighborType.BelowLeft ||\n\t\t\t\t\tn === NeighborType.BelowRight)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tif (sq.rank === 8 && (n === NeighborType.Above ||\n\t\t\t\t\tn === NeighborType.AboveLeft ||\n\t\t\t\t\tn === NeighborType.AboveRight)) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// validate file\n\t\t\tlet\n\t\t\t\tfIndex = 'abcdefgh'.indexOf(sq.file),\n\t\t\t\ti = 0;\n\n\t\t\tif (fIndex !== -1 && sq.rank > 0 && sq.rank < 9) {\n\t\t\t\t// find the index\n\t\t\t\ti = 8 * (sq.rank - 1) + fIndex + n.offset;\n\t\t\t\tif (this.squares && this.squares.length > i && i > -1) {\n\t\t\t\t\treturn this.squares[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSquare (f, r) {\n\t\t// check for shorthand\n\t\tif (typeof f === 'string' && f.length === 2 && !r) {\n\t\t\tr = parseInt(f.charAt(1), 10);\n\t\t\tf = f.charAt(0);\n\t\t}\n\n\t\t// validate file\n\t\tlet\n\t\t\tfIndex = 'abcdefgh'.indexOf(f),\n\t\t\ti = 0;\n\n\t\tif (fIndex !== -1 && r > 0 && r < 9) {\n\t\t\t// Find the index\n\t\t\ti = 8 * (r - 1) + fIndex;\n\t\t\tif (this.squares && this.squares.length > i) {\n\t\t\t\treturn this.squares[i];\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tgetSquares (side) {\n\t\tconst list = [];\n\n\t\tfor (let i = 0; i < this.squares.length; i++) {\n\t\t\tif (this.squares[i].piece && this.squares[i].piece.side === side) {\n\t\t\t\tlist.push(this.squares[i]);\n\t\t\t}\n\t\t}\n\n\t\treturn list;\n\t}\n\n\tmove (src, dest, n) {\n\t\tif (typeof src === 'string' && src.length === 2) {\n\t\t\tsrc = this.getSquare(src);\n\t\t}\n\n\t\tif (typeof dest === 'string' && dest.length === 2) {\n\t\t\tdest = this.getSquare(dest);\n\t\t}\n\n\t\tlet simulate;\n\n\t\tif (typeof n === 'boolean') {\n\t\t\tsimulate = n;\n\t\t\tn = null;\n\t\t}\n\n\t\tif (src && src.file && src.rank && dest && dest.file && dest.rank) {\n\t\t\tlet\n\t\t\t\tmove = {\n\t\t\t\t\talgebraic : n,\n\t\t\t\t\tcapturedPiece : dest.piece,\n\t\t\t\t\tcastle : false,\n\t\t\t\t\tenPassant : false,\n\t\t\t\t\tpostSquare : dest,\n\t\t\t\t\tprevSquare : src\n\t\t\t\t},\n\t\t\t\tp = src.piece,\n\t\t\t\tsq = null,\n\t\t\t\tundo = (b, m) => {\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tif (!simulate) {\n\t\t\t\t\t\t\t// ensure no harm can be done if called multiple times\n\t\t\t\t\t\t\tif (m.undone) {\n\t\t\t\t\t\t\t\tthrow new Error('cannot undo a move multiple times');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tm.undone = true;\n\n\t\t\t\t\t\t\t// emit an undo event\n\t\t\t\t\t\t\tb.emit('undo', m);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tm.prevSquare.piece = m.postSquare.piece;\n\t\t\t\t\t\tm.postSquare.piece = m.capturedPiece;\n\n\t\t\t\t\t\tif (!m.enPassant) {\n\t\t\t\t\t\t\tm.postSquare.piece = m.capturedPiece;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tb.getSquare(\n\t\t\t\t\t\t\t\tm.postSquare.file,\n\t\t\t\t\t\t\t\tm.prevSquare.rank\n\t\t\t\t\t\t\t).piece = m.capturedPiece;\n\n\t\t\t\t\t\t\t// there is no piece on the post square in the event of\n\t\t\t\t\t\t\t// an en-passant, clear anything that me be present as\n\t\t\t\t\t\t\t// a result of the move (fix for issue #8)\n\t\t\t\t\t\t\tm.postSquare.piece = null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (m.castle) {\n\t\t\t\t\t\t\tsq = b.getSquare(\n\t\t\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'f' : 'd',\n\t\t\t\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tb.getSquare(\n\t\t\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'h' : 'a',\n\t\t\t\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t\t\t\t).piece = sq.piece;\n\t\t\t\t\t\t\tsq.piece = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\tdest.piece = p;\n\t\t\tmove.castle = p.type === PieceType.King &&\n\t\t\t\tp.moveCount === 0 &&\n\t\t\t\t(move.postSquare.file === 'g' || move.postSquare.file === 'c');\n\t\t\tmove.enPassant = p.type === PieceType.Pawn &&\n\t\t\t\tmove.capturedPiece === null &&\n\t\t\t\tmove.postSquare.file !== move.prevSquare.file;\n\t\t\tmove.prevSquare.piece = null;\n\n\t\t\t// check for en-passant\n\t\t\tif (move.enPassant) {\n\t\t\t\tsq = this.getSquare(move.postSquare.file, move.prevSquare.rank);\n\t\t\t\tmove.capturedPiece = sq.piece;\n\t\t\t\tsq.piece = null;\n\t\t\t}\n\n\t\t\t// check for castle\n\t\t\tif (move.castle) {\n\t\t\t\tsq = this.getSquare(\n\t\t\t\t\tmove.postSquare.file === 'g' ? 'h' : 'a',\n\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t);\n\n\t\t\t\tif (sq.piece === null) {\n\t\t\t\t\tmove.castle = false;\n\t\t\t\t} else {\n\t\t\t\t\tthis.getSquare(\n\t\t\t\t\t\tmove.postSquare.file === 'g' ? 'f' : 'd',\n\t\t\t\t\t\tmove.postSquare.rank\n\t\t\t\t\t).piece = sq.piece;\n\t\t\t\t\tsq.piece = null;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!simulate) {\n\t\t\t\tp.moveCount++;\n\t\t\t\tthis.lastMovedPiece = p;\n\n\t\t\t\tif (move.capturedPiece) {\n\t\t\t\t\tthis.emit('capture', move);\n\t\t\t\t}\n\n\t\t\t\tif (move.castle) {\n\t\t\t\t\tthis.emit('castle', move);\n\t\t\t\t}\n\n\t\t\t\tif (move.enPassant) {\n\t\t\t\t\tthis.emit('enPassant', move);\n\t\t\t\t}\n\n\t\t\t\tthis.emit('move', move);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tmove,\n\t\t\t\tundo : undo(this, move, simulate)\n\t\t\t};\n\t\t}\n\t}\n\n\tpromote (sq, p) {\n\t\t// update move count and last piece\n\t\tp.moveCount = sq.piece.moveCount;\n\t\tthis.lastMovedPiece = p;\n\n\t\t// set to square\n\t\tsq.piece = p;\n\n\t\tthis.emit('promote', sq);\n\n\t\treturn sq;\n\t}\n}\n\n// exports\nexport default { Board, NeighborType };\n"],"file":"board.js"}